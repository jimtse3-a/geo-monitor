name: Daily Hotwords Collection

on:
  schedule:
    # 每天早8点和晚8点各执行一次（北京时间）
    - cron: '0 0 * * *'  # UTC 00:00 = 北京 08:00
    - cron: '0 12 * * *' # UTC 12:00 = 北京 20:00
  
  # 支持手动触发
  workflow_dispatch:
    inputs:
      platform:
        description: '指定平台 (all/doubao/qianwen/xiaohongshu/douyin)'
        required: false
        default: 'all'

env:
  FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
  FEISHU_SECRET: ${{ secrets.FEISHU_SECRET }}
  FEISHU_BASEID: ${{ secrets.FEISHU_BASEID }}
  TABLE_TRENDS: ${{ secrets.TABLE_TRENDS }}
  TABLE_SKU: ${{ secrets.TABLE_SKU }}

jobs:
  collect:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        path: geo-monitor

    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    - name: Debug directory structure
      run: |
        echo "Current directory: $(pwd)"
        echo "Contents of current directory:"
        ls -la
        echo ""
        echo "Looking for crawlers folder:"
        find . -name "hotwords_crawler.py" -type f 2>/dev/null || echo "File not found"
    
    - name: Run hotwords crawler
      run: |
        if [ -f "crawlers/hotwords_crawler.py" ]; then
          python crawlers/hotwords_crawler.py
        elif [ -f "hotwords_crawler.py" ]; then
          python hotwords_crawler.py
        else
          echo "ERROR: Cannot find hotwords_crawler.py"
          echo "Searched in: crawlers/ and ./"
          find . -name "*.py" -type f | head -20
          exit 1
        fi
    
    - name: Send notification (optional)
      if: always()
      run: |
        echo "热词抓取任务完成 - $(date)"
        # 这里可以添加钉钉/企业微信通知
